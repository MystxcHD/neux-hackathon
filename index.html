<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concept Visualizer</title>
    <style>
        :root {
            --bg-color: #101010;
            --surface1-color: #1e1e1e;
            --text-primary: #f0f0f0;
            --text-secondary: #a0a0a0;
            --accent-primary: #e0e0e0;
            --accent-primary-text: #101010;
            --border-color: #333;
            --dot-color: #3a3a3a;
        }
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            width: 100vw;
            height: 100vh;
            overflow: hidden; /* Prevent scrolling of the whole page */
        }

        /* Canvas container now fills the entire screen */
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            overflow: scroll; 
            cursor: grab; 
        }

        /* This div creates the large scrollable area with the dot background */
        #scroll-padding {
            width: 5000px;
            height: 5000px;
            position: relative;
            pointer-events: none; /* Prevents it from interfering with clicks */
            background-image: radial-gradient(circle, var(--dot-color) 1px, transparent 1px);
            background-size: 20px 20px;
            background-position: center;
        }

        /* Floating panel for inputs */
        #floating-panel {
            position: fixed;
            /* Initial position in the top-right corner */
            left: calc(100vw - 344px); /* 320px width + 24px margin */
            top: 24px;
            width: 320px; /* Made panel smaller */
            min-width: 280px; /* Added min-width */
            min-height: 200px; /* Added min-height */
            max-height: calc(100vh - 48px); /* Ensure it doesn't go off-screen */
            background-color: var(--surface1-color);
            border: 1px solid var(--border-color);
            border-radius: 16px; /* Rounded corners */
            z-index: 10;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); /* Floating effect */
            overflow: hidden; /* To contain rounded corners */
        }
        
        /* Header section within the panel */
        #floating-panel header { 
            padding: 24px 24px 16px 24px;
            border-bottom: 1px solid var(--border-color);
            cursor: move; /* Indicates it's draggable */
            user-select: none; /* Prevent text selection while dragging */
            display: flex; /* Added for collapse button */
            justify-content: space-between; /* Added for collapse button */
            align-items: flex-start; /* Added for collapse button */
            gap: 16px;
        }
        .logo-icon svg { 
            width: 36px; 
            height: 36px; 
            fill: var(--text-primary); 
            margin-bottom: 12px; 
        }
        header h1 { 
            font-size: 1.75rem; 
            font-weight: 700; 
            margin-bottom: 8px; 
        }
        header .subtitle { 
            font-size: 0.95rem; 
            color: var(--text-secondary); 
            line-height: 1.4;
        }

        /* NEW: Collapse Button */
        #collapse-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            margin-top: -4px; /* Align with header text */
            margin-right: -8px;
            border-radius: 6px;
            transition: background-color 0.2s, color 0.2s;
        }
        #collapse-btn:hover {
            background-color: var(--border-color);
            color: var(--text-primary);
        }
        #collapse-btn svg {
            width: 20px;
            height: 20px;
            stroke-width: 2.5;
            transition: transform 0.2s ease-in-out;
        }
        /* End of New Styles */

        /* Form styling */
        #prompt-form {
            padding: 24px;
            flex: 1; /* Makes the form fill the remaining vertical space */
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* Allow form content to scroll */
        }

        .input-section {
            flex: 1; 
            display: flex;
            flex-direction: column;
            text-align: left;
        }

        .input-section label { 
            display: block; 
            font-weight: 600; 
            font-size: 0.9rem; 
            margin-bottom: 12px; 
        }
        
        .input-section textarea {
            width: 100%;
            flex: 1; /* Makes textarea fill the available space */
            min-height: 100px; /* Made textarea smaller */
            background-color: var(--bg-color);
            border: 1px solid #444;
            border-radius: 10px;
            padding: 16px;
            font-family: inherit;
            font-size: 1rem;
            color: var(--text-primary);
            resize: vertical;
        }
        .input-section textarea::placeholder { color: #666; }
        
        #generate-btn {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            width: 100%;
            padding: 16px;
            margin-top: 16px; /* Space between textarea and button */
            background-color: var(--accent-primary);
            color: var(--accent-primary-text);
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        #generate-btn:hover { background-color: #c0c0c0; }
        #generate-btn svg { width: 20px; height: 20px; stroke: var(--accent-primary-text); }

        /* NEW: Styles for Collapsed State */
        #floating-panel.is-collapsed {
            min-height: 0; /* Override min-height when collapsed */
            height: auto; /* Shrink to fit header */
        }
        #floating-panel.is-collapsed #prompt-form {
            display: none;
        }
        #floating-panel.is-collapsed header {
            border-bottom: none; /* Remove border when collapsed */
        }
        #floating-panel.is-collapsed #collapse-btn svg {
            transform: rotate(180deg); /* Flip chevron */
        }
        /* End of New Styles */


        /* Responsive layout for mobile */
        @media (max-width: 768px) {
            #floating-panel {
                /* Docks to the bottom */
                top: auto;
                left: 0;
                bottom: 0;
                width: 100%;
                max-height: 50vh; /* Limit height */
                border-radius: 16px 16px 0 0; /* Rounded top corners */
                border: none;
                border-top: 1px solid var(--border-color);
                box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
            }
            #floating-panel header {
                cursor: default; /* No dragging on mobile */
                padding: 20px 20px 12px 20px;
            }
            #prompt-form {
                padding: 20px;
            }
            header h1 { font-size: 1.5rem; }
            header .subtitle { font-size: 0.9rem; }
            .input-section textarea {
                min-height: 100px;
                flex: 0 1 120px; /* Don't grow, allow shrinking, base size 120px */
            }

            /* NEW: Mobile collapsed state */
            #floating-panel.is-collapsed {
                max-height: 72px; /* Adjust to fit header height */
                overflow: hidden;
            }
        }
    </style>
</head>
<body>

    <!-- Fullscreen canvas -->
    <main id="canvas-container">
        <div id="scroll-padding"></div>
        <!-- This is where a graph or other visualization would be rendered -->
    </main>

    <!-- Floating panel -->
    <aside id="floating-panel">
        <header>
            <div> <!-- Wrapper for content -->
                <div class="logo-icon">
                    <!-- Generic "node" icon -->
                </div>
                <h1>Concept Visualizer</h1>
                <p class="subtitle">Enter any topic to visualize it as an interactive map</p>
            </div>
            <!-- NEW: Collapse Button -->
            <button id="collapse-btn" aria-label="Collapse panel">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" />
                </svg>
            </button>
        </header>

        <form id="prompt-form" action="tree.html" method="GET">
            <section class="input-section">
                <label for="problem-input">Enter a topic or idea</label>
                
                <textarea 
                    id="problem-input"
                    name="prompt" 
                    placeholder="e.g., 'Key concepts of Photosynthesis' or 'History of the Roman Empire'"
                ></textarea>
                
                <button type="submit" id="generate-btn">
                    <!-- Generic "magic" or "generate" icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.036a3.375 3.375 0 0 0 2.456 2.455L21.75 6l-1.036.259a3.375 3.375 0 0 0-2.455 2.456Z"></path></svg>
                    <span>Generate Map</span>
                </button>
            </section>
        </form>
    </aside>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('canvas-container');
            const panel = document.getElementById('floating-panel'); // Get panel reference
            const collapseBtn = document.getElementById('collapse-btn'); // Get button reference

            // 1. Center the view on load
            setTimeout(() => {
                canvas.scrollLeft = (canvas.scrollWidth - canvas.clientWidth) / 2;
                canvas.scrollTop = (canvas.scrollHeight - canvas.clientHeight) / 2;
            }, 0);

            // --- Canvas Panning Logic ---
            let isPanning = false;
            let startX, startY;
            let initialScrollLeft, initialScrollTop;

            canvas.addEventListener('mousedown', (e) => {
                if (e.button !== 0) return;
                
                // IMPORTANT: Check if the click is on the panel or its children
                if (e.target.closest('#floating-panel')) {
                    return;
                }

                e.preventDefault(); 
                isPanning = true;
                canvas.style.cursor = 'grabbing';
                startX = e.clientX;
                startY = e.clientY;
                initialScrollLeft = canvas.scrollLeft;
                initialScrollTop = canvas.scrollTop;
            });

            canvas.addEventListener('mousemove', (e) => {
                if (!isPanning) return;
                e.preventDefault();
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                canvas.scrollLeft = initialScrollLeft - deltaX;
                canvas.scrollTop = initialScrollTop - deltaY;
            });

            const stopPanning = () => {
                if (!isPanning) return;
                isPanning = false;
                canvas.style.cursor = 'grab';
            };

            canvas.addEventListener('mouseup', stopPanning);
            canvas.addEventListener('mouseleave', stopPanning);


            // --- Floating Panel Drag Logic ---
            const panelHeader = panel.querySelector('header');

            let isDraggingPanel = false;
            let startDragX, startDragY;
            let startPanelX, startPanelY;

            // Only attach drag listeners if not on a small screen
            if (window.innerWidth > 768) {
                panelHeader.addEventListener('mousedown', (e) => {
                    if (e.button !== 0) return;
                    
                    // Don't drag if clicking on form elements OR the collapse button
                    if (e.target.closest('button, input, textarea, a, #collapse-btn')) return;

                    isDraggingPanel = true;
                    panel.style.userSelect = 'none'; // Prevent text selection
                    
                    startDragX = e.clientX;
                    startDragY = e.clientY;

                    const rect = panel.getBoundingClientRect();
                    startPanelX = rect.left;
                    startPanelY = rect.top;

                    document.addEventListener('mousemove', onPanelDrag);
                    document.addEventListener('mouseup', onPanelDragEnd);
                });
            }

            function onPanelDrag(e) {
                if (!isDraggingPanel) return;

                const deltaX = e.clientX - startDragX;
                const deltaY = e.clientY - startDragY;
                
                let newX = startPanelX + deltaX;
                let newY = startPanelY + deltaY;

                // Constrain to viewport
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                const panelWidth = panel.offsetWidth;
                const panelHeight = panel.offsetHeight;

                // Keep panel within 10px of the edges
                newX = Math.max(10, Math.min(newX, viewportWidth - panelWidth - 10));
                newY = Math.max(10, Math.min(newY, viewportHeight - panelHeight - 10));

                panel.style.left = newX + 'px';
                panel.style.top = newY + 'px';
                panel.style.right = 'auto'; // Disable the 'right' styling
                panel.style.bottom = 'auto'; // Disable the 'bottom' styling
            }

            function onPanelDragEnd() {
                isDraggingPanel = false;
                panel.style.userSelect = 'auto';
                document.removeEventListener('mousemove', onPanelDrag);
                document.removeEventListener('mouseup', onPanelDragEnd);
            }

            // --- NEW: Collapse Logic ---
            collapseBtn.addEventListener('click', () => {
                panel.classList.toggle('is-collapsed');
            });

        });
    </script>

</body>
</html>

